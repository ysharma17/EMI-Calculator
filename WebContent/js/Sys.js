
/************************************
* Developed by Illimar Pihlamäe		*
* e-mail: illimar@idra.pri.ee		*
* Euroland Estonia © 2012			*
* e-mail: illimar@euroland.com		*
*************************************/

var Sys={Format:{Number:{decimalPlaces:2,thousandPlaces:1,optionalDecimalPlaces:0,Separator:{thousand:",",decimal:"."},negativeFormat:"([nr])",setFormat:function(format){return;},_getFormatedDecimals:function(decimal,decimalPlaces){var ret='',temp,i,numbersBase10Weight;if(decimal > 0)numbersBase10Weight=Math.log(decimal)/Math.log(10);else	numbersBase10Weight=0;numbersBase10Weight=Math.floor(numbersBase10Weight);decimal*=Math.pow(10,decimalPlaces);if(Sys.Format.Number.optionalDecimalPlaces){temp=Sys.Format.Number.optionalDecimalPlaces;while(temp){if(Math.floor(decimal)< decimal){decimal*=10;}temp--;}}decimal=Math.round(decimal);if(!decimal&&decimalPlaces){for(i=0;i < decimalPlaces;i++){ret+='0';}ret=Sys.Format.Number.Separator.decimal+ret;}else if(decimal&&decimalPlaces){ret=decimal;numbersBase10Weight*=-1;for(i=1;i < numbersBase10Weight;i++){ret='0'+ret;}ret=Sys.Format.Number.Separator.decimal+ret;}return ret;}},date:"dd/MM/yyyy",Set:{number:function(nr,decimalPlaces){if(typeof nr!='number')return nr;if(typeof decimalPlaces=='number'){decimalPlaces=Math.floor(decimalPlaces);}else	decimalPlaces=Sys.Format.Number.decimalPlaces+Sys.Format.Number.optionalDecimalPlaces;var decimal,ret='',temp,i,nrOfNumbers,isNegative,numbersBase10Weight;	temp=Math.pow(10,decimalPlaces);	nr=Math.round(nr*temp,decimalPlaces)/temp;if(nr < 0){nr*=-1;isNegative=true;}decimal=nr-Math.floor(nr);nr=nr-decimal;if(decimalPlaces > 0){ret+=Sys.Format.Number._getFormatedDecimals(decimal,decimalPlaces);}else if(decimal){nr=Math.round(nr);}nrOfNumbers=0;if(nr){nr=String(nr);for(i=nr.length-1;i >-1;i--){if(nrOfNumbers % 3==0&&nrOfNumbers)ret=Sys.Format.Number.Separator.thousand+ret;ret=nr.charAt(i)+ret;nrOfNumbers++;}}if(Sys.Format.Number.thousandPlaces > nrOfNumbers&&Sys.Format.Number.thousandPlaces){temp=Sys.Format.Number.thousandPlaces-nrOfNumbers;while(temp){if(nrOfNumbers % 3==0&&nrOfNumbers)ret=Sys.Format.Number.Separator.thousand+ret;ret='0'+ret;nrOfNumbers++;temp--;}}return isNegative ? Sys.Format.Number.negativeFormat.replace("[nr]",ret):ret;},date:function(date,strDateFormat){if(typeof date!='object'){return '';}if(typeof date.day!='number'){var obj=new Object();obj.day=date.getDate();obj.month=date.getMonth()+1;obj.year=date.getFullYear();obj.minutes=date.getMinutes();obj.hours=date.getHours();date=obj;}var ret=typeof strDateFormat=='string' ? strDateFormat:Sys.Format.date,temp;try{ret=ret.replace("dd",(date.day < 10 ? '0':'')+date.day);ret=ret.replace("d",date.day);	ret=ret.replace("MM",(date.month < 10 ? '0':'')+date.month);ret=ret.replace("M",date.month);ret=ret.replace("mm",(date.minutes < 10 ? '0':'')+date.minutes);ret=ret.replace("m",date.minutes);ret=ret.replace("HH",(date.hours < 10 ? '0':'')+date.hours);ret=ret.replace("H",date.hours);ret=ret.replace("yyyy",date.year);temp=String(date.year);ret=ret.replace("yy",temp.substring(temp.length-2));}catch(e){ret="";}return ret;}}},Key:{ESC:27,ARROW_RIGHT:39,ARROW_LEFT:37,ARROW_TOP:38,ARROW_BOTTOM:40,ENTER:13,NUM_MINUS:109,NUM_PLUS:107,KeyUp:{check:function(e){var code,i,obj;if(!e)var e=window.event;if(e.keyCode)code=e.keyCode;else if(e.which)code=e.which;	for(i=0;i < Sys.Key.KeyUp._events.length;i++){obj=Sys.Key.KeyUp._events[i];if(obj.active){if(obj.key==code){if(typeof obj.call=="function")obj.call(obj.arguments);}}}return;},_events:new Array(),_eventIndex:new Array(),addEvent:function(name,key,call,arguments,active){if(name==undefined)return false;if(key==undefined)key=null;if(key==undefined)call=null;if(arguments==undefined)arguments=null;if(active==undefined)active=false;Sys.Key.KeyUp._eventIndex[name]=Sys.Key.KeyUp._events.length;Sys.Key.KeyUp._events.push({"name":name,"active":active,"key":key,"call":call,"arguments":arguments});document.onkeyup=Sys.Key.KeyUp.check;return true;},getEvent:function(strEventName){var index=Sys.Key.KeyUp._eventIndex[strEventName];if(index==undefined)return null;return Sys.Key.KeyUp._events[index];}},KeyDown:{check:function(e){var code,i,obj;if(!e)var e=window.event;if(e.keyCode)code=e.keyCode;else if(e.which)code=e.which;	for(i=0;i < Sys.Key.KeyDown._events.length;i++){obj=Sys.Key.KeyDown._events[i];if(obj.active){if(obj.key==code){if(typeof obj.call=="function")obj.call(obj.arguments);}}}return;},_events:new Array(),_eventIndex:new Array(),addEvent:function(name,key,call,arguments,active){if(name==undefined)return false;if(key==undefined)key=null;if(key==undefined)call=null;if(arguments==undefined)arguments=null;if(active==undefined)active=false;Sys.Key.KeyDown._eventIndex[name]=Sys.Key.KeyDown._events.length;Sys.Key.KeyDown._events.push({"name":name,"active":active,"key":key,"call":call,"arguments":arguments});document.onkeydown=Sys.Key.KeyDown.check;return true;},getEvent:function(strEventName){var index=Sys.Key.KeyDown._eventIndex[strEventName];if(index==undefined)return null;return Sys.Key.KeyDown._events[index];}}},Mouse:{x:0,y:0,move:function(e){if(!e)var e=window.event;if(e.touches){if(e.touches.length > 1)return;var touch=e.touches[0];if(typeof touch=='object'){Sys.Mouse.x=touch.pageX;Sys.Mouse.y=touch.pageY;}}else{if(e.pageX||e.pageY){Sys.Mouse.x=e.pageX;Sys.Mouse.y=e.pageY;}else if(e.clientX||e.clientY){Sys.Mouse.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;Sys.Mouse.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;}}Sys.Mouse.checkPos();},_events:new Array(),_eventIndex:new Array(),checkPos:function(){var inArea,x1,x2,y1,y2,j,i=Sys.Mouse._events.length;while(i--){var obj=Sys.Mouse._events[i];if(obj.active){x1=obj.x1;x2=obj.x2;y1=obj.y1;y2=obj.y2;if(x1==null||x2==null||y1==null||y2==null){if(typeof obj.call=="function")obj.call(obj.arguments);continue;}if(typeof x1=='object'||typeof x2=='object'||typeof y1=='object'||typeof y2=='object'){if(x2.length==x1.length&&y1.length==x1.length&&y2.length==x1.length){j=x1.length;inArea=false;while(j--&&!inArea){inArea=Sys.Mouse.x >=x1[j]&&Sys.Mouse.x <=x2[j]&&Sys.Mouse.y >=y1[j]&&Sys.Mouse.y <=y2[j];}}else	continue;}else	inArea=Sys.Mouse.x >=x1&&Sys.Mouse.x <=x2&&Sys.Mouse.y >=y1&&Sys.Mouse.y <=y2;if(inArea){if(typeof obj.call=="function")obj.call(obj.arguments);}else if(typeof obj.oppCall=="function")obj.oppCall(obj.arguments);}}},addEvent:function(strName,call,x1,y1,x2,y2,active,arguments,oppCall){var _strName="",_x1=0,_x2=0,_y1=0,_y2=0,_call=null,_active=false;Sys.Mouse._events.push({"name":strName==undefined ? _strName:strName,"active":active==undefined ? _active:active,"arguments":arguments==undefined ? null:arguments,"call":call==undefined ? _call:call,"oppCall":oppCall==undefined ? null:oppCall,"x1":x1==undefined&&x1!=null ? _x1:x1,"x2":x2==undefined&&x2!=null ? _x2:x2,"y1":y1==undefined&&y1!=null ? _y1:y1,"y2":y2==undefined&&y2!=null ? _y2:y2});var index=Sys.Mouse._events.length-1;Sys.Mouse._eventIndex[Sys.Mouse._events[index].name]=index;Sys.Mouse.activatePositionChecker();return;},activatePositionChecker:function(){switch(Page.browser){case "iPad":case "iPhone":document.ontouchmove=Sys.Mouse.move;document.ontouchstart=Sys.Mouse.move;break;default:document.onmousemove=Sys.Mouse.move;break;}},getEvent:function(strEventID){var index=Sys.Mouse._eventIndex[strEventID];if(index==undefined)return null;return Sys.Mouse._events[index];},closeEvent:function(EventID){Sys.Mouse._events[Sys.Mouse._eventIndex[EventID]].active=false;return;},openEvent:function(EventID){Sys.Mouse._events[Sys.Mouse._eventIndex[EventID]].active=true;return;},updateEventXY:function(strId,newX1,newY1,isOffset){var event=Sys.Mouse.getEvent(strId);if(typeof event.x1=='object'){var i=event.x1.length;offsetX=newX1;offsetY=newY1;while(i--){event.x1[i]+=offsetX;event.x2[i]+=offsetX;event.y1[i]+=offsetY;event.y2[i]+=offsetY;}}else{offsetX=newX1-event.x1;offsetY=newY1-event.y1;event.x1+=offsetX;event.x2+=offsetX;event.y1+=offsetY;event.y2+=offsetY;}},removeEvent:function(EventID){var obj=Sys.Mouse._events,index=Sys.Mouse._eventIndex[EventID];Sys.Mouse._events.splice(index,1);for(;index < obj.length;index++){obj[index]--;}},MouseUp:{_events:new Array(),addEvent:function(name,call,arguments){Sys.Mouse.MouseUp._events.push({'name':name,'call':call,'arguments':arguments});document.onmouseup=Sys.Mouse.MouseUp.call;document.ontouchend=Sys.Mouse.MouseUp.call;},call:function(){var index=Sys.Mouse.MouseUp._events.length,event;while(index--){event=Sys.Mouse.MouseUp._events[index];if(typeof event.call=='function');event.call(event.arguments);}}}}};